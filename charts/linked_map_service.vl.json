{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Mental Health Service Access - Interactive Map & Chart",
    "fontSize": 18,
    "font": "Merriweather",
    "anchor": "start"
  },
  "data": {
    "values": [
      {"state": "New South Wales", "state_abbr": "NSW", "access_rate": 45.2, "prevalence": 19.5},
      {"state": "Victoria", "state_abbr": "VIC", "access_rate": 48.1, "prevalence": 21.8},
      {"state": "Queensland", "state_abbr": "QLD", "access_rate": 42.3, "prevalence": 20.3},
      {"state": "South Australia", "state_abbr": "SA", "access_rate": 46.7, "prevalence": 22.1},
      {"state": "Western Australia", "state_abbr": "WA", "access_rate": 43.9, "prevalence": 19.9},
      {"state": "Tasmania", "state_abbr": "TAS", "access_rate": 41.5, "prevalence": 23.4},
      {"state": "Northern Territory", "state_abbr": "NT", "access_rate": 38.2, "prevalence": 18.7},
      {"state": "Australian Capital Territory", "state_abbr": "ACT", "access_rate": 51.3, "prevalence": 24.2}
    ]
  },
  "params": [
    {
      "name": "state_selection",
      "select": {"type": "point", "fields": ["state"]}
    }
  ],
  "hconcat": [
    {
      "width": 400,
      "height": 350,
      "projection": {
        "type": "mercator",
        "center": [133, -28],
        "scale": 550
      },
      "layer": [
        {
          "data": {
            "sphere": true
          },
          "mark": {
            "type": "geoshape",
            "fill": "lightblue",
            "stroke": "none"
          }
        },
        {
          "data": {
            "graticule": {
              "step": [10, 10]
            }
          },
          "mark": {
            "type": "geoshape",
            "stroke": "lightgray",
            "strokeWidth": 0.5,
            "fill": null
          }
        },
        {
          "data": {
            "url": "datasets/australia_states.geojson",
            "format": {
              "type": "json",
              "property": "features"
            }
          },
          "transform": [
            {
              "lookup": "properties.STATE_NAME",
              "from": {
                "data": {
                  "values": [
                    {"state": "New South Wales", "access_rate": 45.2},
                    {"state": "Victoria", "access_rate": 48.1},
                    {"state": "Queensland", "access_rate": 42.3},
                    {"state": "South Australia", "access_rate": 46.7},
                    {"state": "Western Australia", "access_rate": 43.9},
                    {"state": "Tasmania", "access_rate": 41.5},
                    {"state": "Northern Territory", "access_rate": 38.2},
                    {"state": "Australian Capital Territory", "access_rate": 51.3}
                  ]
                },
                "key": "state",
                "fields": ["access_rate"]
              }
            },
            {
              "calculate": "datum.properties.STATE_NAME",
              "as": "state"
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "white",
            "strokeWidth": 1.5,
            "cursor": "pointer"
          },
          "encoding": {
            "color": {
              "field": "access_rate",
              "type": "quantitative",
              "scale": {
                "scheme": "teals",
                "domain": [35, 55]
              },
              "legend": {
                "title": "Service Access (%)",
                "orient": "bottom-left",
                "titleFontSize": 11,
                "labelFontSize": 10
              }
            },
            "opacity": {
              "condition": {"param": "state_selection", "value": 1},
              "value": 0.4
            },
            "strokeWidth": {
              "condition": {"param": "state_selection", "value": 3},
              "value": 1.5
            },
            "tooltip": [
              {"field": "state", "type": "nominal", "title": "State/Territory"},
              {"field": "access_rate", "type": "quantitative", "title": "Service Access (%)", "format": ".1f"}
            ]
          }
        }
      ]
    },
    {
      "width": 350,
      "height": 350,
      "mark": {
        "type": "bar",
        "cornerRadiusEnd": 4
      },
      "encoding": {
        "y": {
          "field": "state_abbr",
          "type": "nominal",
          "title": "State/Territory",
          "axis": {
            "labelFontSize": 11
          },
          "sort": "-x"
        },
        "x": {
          "field": "access_rate",
          "type": "quantitative",
          "title": "% Who Consulted Health Professional",
          "scale": {
            "domain": [0, 60]
          },
          "axis": {
            "labelFontSize": 11
          }
        },
        "color": {
          "field": "access_rate",
          "type": "quantitative",
          "scale": {
            "scheme": "teals",
            "domain": [35, 55]
          },
          "legend": null
        },
        "opacity": {
          "condition": {"param": "state_selection", "value": 1},
          "value": 0.3
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State/Territory"},
          {"field": "access_rate", "type": "quantitative", "title": "Access Rate (%)", "format": ".1f"},
          {"field": "prevalence", "type": "quantitative", "title": "Prevalence (%)", "format": ".1f"}
        ]
      }
    }
  ]
}
